# <a href="#" id="start"></a>四、测试电机相线和霍尔线接线顺序

对于本驱动器，理论上任意的电机相线接线，都有一组对应的霍尔接线使电机正常运作，因此可以先任意指定电机相线接线顺序，这里我们指定mA接电机黄线、mB接电机绿线、mC接电机蓝线；下文会介绍如何确定霍尔线序。

霍尔线序不正确情况下，驱动器需要设置成“速度开环模式”，同时转速下发指令值不要大于20，这样可以防止异常大电流顺坏电机线圈和驱动管。两个电机的线序是一样的，即左轮和右轮的电机电机线、霍尔线的顺序是一模一样的，因此下文的测试只针对左轮电机。

# <a href="#" id="open"></a>4.1 速度开环模式
![huoer-1](../images/huoer-1.png)

点击“开环”，驱动器会临时进入“速度开环”控制模式，此时电机PWM开关量直接正比于转速指令。重启驱动器会使驱动器退出“速度开环”控制模式，进入默认的速度闭环模式。

# <a href="#" id="order"></a>4.2 确定霍尔线顺序
保证驱动器处于“速度开环”模式，以左轮电机为例，假设电机霍尔线三根的颜色分别为黄1、绿2、蓝3。

|霍尔线接口|排列1|排列2|排列3|排列4|排列5|排列6|
|:---------:|:--:|:--:|:--:|:--:|:--:|:--:|
|HA   |黄1   |黄1   |绿2   |绿2   |蓝3   |蓝3   |
|HB   |绿2   |蓝3   |黄1   |蓝3   |黄1   |绿2   |
|HC   |蓝3   |绿2   |蓝3   |黄1   |绿2   |黄1   |

依次尝试上表6种接线顺序，对于每一种接线顺序：

a.	下发10控制量看电机是否流畅运转，如果不正常则说明这组顺序是错误，请“置零”然后测试下一组接线；如果正常则执行操作b。

b.	下发-10控制量看电机是否流畅运转，如果不正常则说明这组顺序是错误，请“置零”然后回到a测试下一组接线；如果正常则说明霍尔线序是正确的，继续步骤c。

![huoer2](../images/huoer-2.png)

c．现在电机基本可以正常运转了，最后需要确定控制量方向和转速反馈方向是一致的，比如下发大于零的转速控制量，正常应该返回大于零的转速，这样才能速度闭环。先正向加大速度控制量，使转速大于200RPM或者小于-200RPM；然后反向加大速度控制量，同样使转速大于200RPM或者小于-200RPM。操作完成后，软件会自动判断控制方向是否与转速方向相反，如果出现下图提示，则按“是”，如果没有出现，说明调试已经完成可以继续速度闭环测试。

![huoer2](../images/huoer-3.png)

# <a href="#" id="close"></a>4.3 速度闭环调速测试
根据上节确定的霍尔线序，把右轮电机也接入驱动器，然后重启驱动器，等驱动器初始化完毕。现在任意调整下图滑块，即可设置电机转速。

![huoer2](../images/huoer-4.png)

控制的同时，还可以观察速度反馈值。

![huoer2](../images/huoer-5.png)

# <a href="#" id="direction"></a>4.4 调整电机正转方向
速度闭环控制成功的前提下，如果发现电机正转方向和自己需要的方向是相反的，首先根据3.3节判断安装方向是否设置正确，如果安装方向设置正确，则将电机相线的ma 和Mb对调,同时把霍尔线的HA和HC对调，这样可以把电机正转方向调换一下。
